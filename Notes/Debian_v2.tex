\documentclass[10pt, a4paper, onecolumn, openany]{book} % openany make chapter start whenever, DELETE in OFFICIAL

% PACKAGES:
% Font Encoding
\usepackage[utf8]{inputenc}     % Use UTF-8
\usepackage[T1]{fontenc}        % T1 font encoding (latin characters)
% Header
\usepackage{fancyhdr}           % fancy page header options
\usepackage{titlesec}           % used to have \thechapter in same line as \chaptertitlename
% MISC
\usepackage{hyperref}           % \url{}
\usepackage{xurl}
\usepackage{graphicx}           % images
\usepackage{xcolor}            % colors
\usepackage{fancyvrb}          % colors in Verbatin, header: \begin{Verbatim}[commandchars=\\\{\}]

% DECORATIVE LINES + CHAPTER IN SAME LINE:
\renewcommand{\headrulewidth}{2pt}  % Top decorative line
\renewcommand{\footrulewidth}{2pt}  % Bottom decorative line
\pagestyle{fancy}                   % better header for normal pages, not only chapter ones
\fancyhf{}                          % clear header and adjust as wanted:
    \chead{\leftmark}               % header
    \cfoot{Page \thepage}           % footer
\fancypagestyle{plain}{
\fancyhf{} 
    \chead{\leftmark}       % header
    \cfoot{Page \thepage}   % footer
}
\renewcommand{\chaptername}{}       % change word chapter to {}
\titleformat{\chapter}[hang]{\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter.}{1em}{} % Chapter in same line as chapter name

% SIZES OF SECTIONS:
\titleformat*{\section}{\LARGE\bfseries}
\titleformat*{\subsection}{\Large\bfseries}
\titleformat*{\subsubsection}{\large\bfseries}

% DISABLE huge space after (paragraph indent) section name before text starts:
\setlength{\parindent}{0pt}

% COLOR EXAMPLES:
% \definecolor{MyColor}{RGB}{219, 48, 122}  % define
% \textcolor{MyColor}{Some random text}     % usage in document
\definecolor{root}{RGB}{222, 0, 0}
\definecolor{user}{RGB}{0, 150, 00}
\definecolor{dir}{RGB}{0, 100, 200}
\definecolor{file}{RGB}{77, 187, 101}
\definecolor{block}{RGB}{255, 80, 0}
\definecolor{command}{RGB}{41, 182, 0}
\definecolor{comment}{RGB}{0, 182, 182}
\definecolor{background}{RGB}{240, 240, 240}

% COLORS FOR CODE in document:
%\begin{minted}[frame=lines,framesep=2mm,baselinestretch=1.2,fontsize=\footnotesize,linenos]{js}
%\end{minted}

% IMAGES:
\graphicspath{./images/} % define directory
% \includegraphics[scale=1.5]{./images/random_image.png} % usage in document

% TABLE:
% \begin{center}
%    \begin{small}
%    \begin{tabular}{|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|p{1cm}|}
%    \hline
%    + & - & * & / & \% & ** & () \\
%    \hline
%    1 & 2 & 3 & 4 & 5 & 6 & 7 \\
%    \hline
%    \end{tabular}
%    \end{small}
%\end{center}

%\titlespacing*{\section}{0pt}{1.5cm}{0.2cm}
%\titlespacing*{\subsection}{0pt}{0.2cm}{0.2cm}

% colored verbatim BG:
%\let\oldv\verbatim
%\let\oldendv\endverbatim
%\def\verbatim{\par\setbox0\vbox\bgroup\oldv}
%\def\endverbatim{\oldendv\egroup\fboxsep0pt \noindent\colorbox[gray]{0.9}{\usebox0}\par}
% colored Verbatim BG (supported colors: https://linuxhint.com/change-text-colors-latex/):
\renewcommand{\FancyVerbFormatLine}[1]{\colorbox{background}{#1}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% TITLE %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{\textbf{Debian v2}}
\author{AISK}
\date{September, 2021}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% START %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
\maketitle
%\clearpage % official blank page
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Physical Access %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Pre-Installation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Check Harddrive for bad sectors}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Theory}
\begin{itemize}
    \item \textbf{Block:} every file must occupy at least 1 block. 0b file occupy whole block.
    \begin{itemize}
        \item \textbf{512b =} good for lot of small files. More blocks = more metadata.
        \item \textbf{4096b =}  good for larger files, less metadata. Waste if there are small files.
    \end{itemize}
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Info gathering}
\begin{itemize}
    \item Info about block devices:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$}  \textcolor{command}{lsblk} [-ap | -apf]
\textcolor{root}{root#}  \textcolor{command}{fdisk -l} <\textcolor{block}{/dev/sdX}>
\textcolor{root}{root#}  \textcolor{command}{blkid}
\end{Verbatim}
    \item Get disk blocksize in bytes:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getbsz <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
    \item Get disk size in bytes:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getsize64 <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
    \item Check if device is readonly (1 = ro, 0 = rw):
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{blockdev} [-v] --getro <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Check for bad sectors}
\begin{enumerate}
    \item Unmount FS!
    \item Check for bad blocks:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{badblocks} [-b 4096] [-w [-t 0xaa]] [-v] [-s] [-o <FILE>] <\textcolor{block}{/dev/sdX[Y]}>
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Flash USB %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Flash USB}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Flash ISO to USB}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{enumerate}
    \item Download ISO from: \underline{\url{https://www.debian.org/distrib/}}
    \item Unmount FS!
    \item Flash:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{dd} if=<\textcolor{file}{/<PATH>/<ISO.iso>}> of=<\textcolor{block}{/dev/sdX}> [bs=4M | status=progress]
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Post-Installation %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Post-Installation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Disable pcspkr}
\begin{enumerate}
    \item Turn off bell for CLI mode:
\newline File: (\textcolor{file}{/etc/inputrc}):
\begin{Verbatim}[commandchars=\\\{\}]
set bell-style none
\end{Verbatim}
    \item Blacklist pcspkr module:
\newline File: (\textcolor{file}{/etc/modprobe.d/blacklist.conf}):
\begin{Verbatim}[commandchars=\\\{\}]
blacklist pcspkr
\end{Verbatim}
    \item Update initramfs:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{depmod} -a
\textcolor{root}{root#} \textcolor{command}{update-initramfs} -u
\textcolor{root}{root#} \textcolor{command}{reboot}
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{APT sources}
\begin{enumerate}
    \item Avoid using \textit{stable}, use \textit{release-name} instead.
    \item APT sources file:
\newline File (\textcolor{file}{/etc/apt/sources.list}):
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{## deb http://deb.debian.org/debian testing main [contrib] [non-free]}
\textcolor{comment}{## deb-src http://deb.debian.org/debian testing main [contrib] [non-free]}

deb http://deb.debian.org/debian bullseye main contrib non-free
deb-src http://deb.debian.org/debian bullseye main contrib non-free

deb http://deb.debian.org/debian-security/ bullseye-security main contrib non-free
deb-src http://deb.debian.org/debian-security/ bullseye-security main contrib non-free

deb http://deb.debian.org/debian bullseye-updates main contrib non-free
deb-src http://deb.debian.org/debian bullseye-updates main contrib non-free
\end{Verbatim}
    \item Update system:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{apt} clean
\textcolor{root}{root#} \textcolor{command}{apt} update
\textcolor{root}{root#} \textcolor{command}{apt} full-upgrade
\textcolor{root}{root#} \textcolor{command}{apt} autoremove
\textcolor{root}{root#} \textcolor{command}{init} 6
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Drivers}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Network Drivers}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{iwlwifi}
\begin{enumerate}
    \item Needs \textit{contrib} and \textit{non-free} packages!
    \item Install driver:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{apt} install firmware-iwlwifi
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% GRUB %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{GRUB}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Configuration}
\begin{enumerate}
    \item Basic GRUB settings:
\newline File (\textcolor{file}{/etc/default/grub}):
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{## do not rename net interfaces:}
GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"

\textcolor{comment}{## highlighted default entry:}
GRUB_DEFAULT=0
\textcolor{comment}{## boot default entry in X seconds, 0=immediately, -1=never:}
GRUB_TIMEOUT=-1
\textcolor{comment}{## menu=timeout to select entry, hidden=timeout to show grub:}
GRUB_TIMEOUT_STYLE=menu
\textcolor{comment}{## disable recovery menu entry:}
GRUB_DISABLE_RECOVERY=true
\textcolor{comment}{## GRUB BG image (*.jpg or *.png) - gfxterm only:}
#GRUB_BACKGROUND="\textcolor{file}{/boot/grub/<image.png>}"
\textcolor{comment}{## theme - gfxterm only:}
#GRUB_THEME="\textcolor{file}{/boot/grub/themes/<THEME>/theme.txt}"
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Menu Colors}
\begin{center}
    \begin{small}
    \begin{tabular}{|p{4cm}|p{4cm}|}
    \hline
    \textbf{Color BG} & \textbf{Color BG + FG} \\
    \hline
    black & X \\
    \hline
    blue & light-blue \\
    \hline
    green & light-green \\
    \hline
    cyan & light-cyan \\
    \hline
    red & light-red \\
    \hline
    magenta & light-magenta \\
    \hline
    brown & yellow \\
    \hline
    light-gray & dark-gray  \\
    \hline
    \end{tabular}
    \end{small}
\end{center}
\begin{enumerate}
    \item Edit customization file:
\newline File (\textcolor{file}{/boot/grub/custom.cfg}):
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{## <foreground>/<background>}
set color_normal=white/black
set color_highlight=black/white
set menu_color_normal=white/black
set menu_color_highlight=black/white
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Update GRUB}
\begin{enumerate}
    \item Update GRUB:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{grub-mkconfig} -o \textcolor{file}{/boot/grub/grub.cfg}
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Local Settings %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Local Settings}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Password}
\begin{itemize}
    \item User-change:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{passwd}
\end{Verbatim}
    \item Root-change:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{passwd} root
\end{Verbatim}
\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Privilege escalation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{doas}
\begin{enumerate}
    \item Install:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{apt} install doas
\end{Verbatim}
    \item Configuration:
\newline File (\textcolor{file}{/etc/doas.conf}):
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{comment}{#<permit|deny> [nopass|persist] <USER>[:GROUP] [as <USER2>]}
\textcolor{comment}{[cmd <COMMAND> [args <ARGUMENTS>]}
permit nopass <USER>
\end{Verbatim}    
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Hostname}
\begin{enumerate}
    \item Display hostname:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{hostname}
\end{Verbatim}
    \item Change hostname:
\newline File (\textcolor{file}{/etc/hostname}):
\begin{Verbatim}[commandchars=\\\{\}]
<HOSTNAME>
\end{Verbatim}
File (\textcolor{file}{/etc/hosts}):
\begin{Verbatim}[commandchars=\\\{\}]
...
127.0.1.1   <HOSTNAME>
...
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Time and Date}
\begin{enumerate}
    \item Show current timezone:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{timedatectl} -a
\end{Verbatim}
    \item List available timezones:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{timedatectl} list-timezones
\end{Verbatim}
    \item Change timezone:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{root}{root#} \textcolor{command}{timedatectl} set-timezone <UTC|Europe/Copenhagen>
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Locales and Keyboard}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Locales}
\begin{enumerate}
    \item Show current locales:
\begin{Verbatim}[commandchars=\\\{\}]
\textcolor{user}{user\$} \textcolor{command}{locale}
\end{Verbatim}
    \item Change locales:
\newline File: (\textcolor{file}{/etc/default/locale}):
\begin{Verbatim}[commandchars=\\\{\}]
LANG=en_US.UTF-8
\textcolor{comment}{# First day in a week MON, not SUN:}
#LC_TIME="en_GB.UTF-8"
\textcolor{comment}{# Default paper size:}
#LC_PAPER="en_GB.UTF-8"
#LC_MEASUREMENT="en_GB.UTF-8"
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{CLI Keyboard}
\begin{itemize}
    \item Available keyboards: \textcolor{dir}{/usr/share/keymaps/i386/}
\end{itemize}
\begin{enumerate}
    \item Set keyboard:
\newline File (\textcolor{file}{/etc/default/keyboard}):
\begin{Verbatim}[commandchars=\\\{\}]
XKBMODEL="pc105"
XKBLAYOUT="us"
XKBVARIANT=""
XKBOPTIONS=""
BACKSPACE="guess"
\end{Verbatim}
\end{enumerate}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Network %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%





\end{document}
